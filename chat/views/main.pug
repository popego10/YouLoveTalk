extends layout

block content
  h1(style='margin:20px;') YouLoveTalk
  
  a(toggle='modal' href='/room' style='position: absolute; top: 20px; right: 20px;' target='#createRoom' role='button')
    i.fa.fa-plus-square(aria-hidden='true' style='font-size:50px;color:#f2c029;' target='#createRoom' role='button' id='plus')

  div(style='margin:20px; border: 3px solid #cbcbcb; padding:30px;')
    fieldset
      table
        thead
          tr
            th 종류
            th 채팅방 제목
            th 방장 회원
            th
        tbody
          for room in rooms
            tr(data-id=room._id)
              td= room.password ? '비밀방' : '공개방'
              td= room.title
              td(style='color:' + room.owner)= room.owner
              -var password = room.password ? 'true' : 'false';
              td: button(data-password=password data-id=room._id).join-btn 입장
              //- td: button(data-password=password data-id=room._id).join-btn
              //-   i.fa.fa-comment-dots(aria-hidden='true' style='font-size:20px;color:#282c37;')
    .error-message= error
 
  script(src='/socket.io/socket.io.js')
  script.
    var socket = io.connect('http://192.168.0.13:8005/room', {
      path: '/socket.io'
    });
    socket.on('newRoom', function (data) {
      var tr = document.createElement('tr');
      var td = document.createElement('td');
      
      td.textContent = data.password ? '비밀방' : '공개방';
      tr.appendChild(td);
      
      td = document.createElement('td');
      td.textContent = data.title;
      tr.appendChild(td);
                  
      td = document.createElement('td');
      td.style.color = data.owner;
      td.textContent = data.owner;
      tr.appendChild(td);
      td = document.createElement('td');
      
      var button = document.createElement('td');
      //button.textContent = '입장';
      button.dataset.password = data.password ? 'true' : 'false';
      button.dataset.id = data._id;
      button.addEventListener('click', addBtnEvent);
      td.appendChild(button);
      tr.appendChild(td);
      tr.dataset.id = data._id;
      document.querySelector('table tbody').appendChild(tr);
    });
    socket.on('removeRoom', function (data) {
      document.querySelectorAll('tbody tr').forEach(function (tr) {
        if (tr.dataset.id === data) {
          tr.parentNode.removeChild(tr);
        }
      });
    });
    //채팅방 입장하는 function
    function addBtnEvent(e) {
      if (e.target.dataset.password === 'true') {
        const password = prompt('비밀번호를 입력하세요');
        location.href = '/room/' + e.target.dataset.id + '?password=' + password;
      } else {
        location.href = '/room/' + e.target.dataset.id;
      }
    }
    document.querySelectorAll('.join-btn').forEach(function (btn) {
      btn.addEventListener('click', addBtnEvent);
    });
    
    //- //채팅방 생성 function
    //- function createRoom(){
    //-   .modal.fade(tabindex='-1', role='dialog', aria-hidden='true' id='createRoom')
    //-     .modal-dialog(role='document')
    //-       .modal-content
    //-         .modal-body
    //-           p Content
    //- }

    //- $(function(){
    //-   ${#plus}.on('click', function({
    //-     createRoom();
    //-   }))
    //- })
    